- uses: actions/checkout@v4

- name: Set up JDK 11
  uses: actions/setup-java@v4
  with:
    java-version: '11'
    distribution: 'temurin'
    cache: gradle

# 安装 Android command line tools 并用 sdkmanager 安装 platform/build-tools
- name: Install Android SDK command-line tools
  run: |
    export ANDROID_SDK_ROOT=$HOME/Android/Sdk
    mkdir -p $ANDROID_SDK_ROOT/cmdline-tools
    cd /tmp
    wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O cmdline.zip
    unzip -q cmdline.zip -d cmdline-tools-temp
    mkdir -p $ANDROID_SDK_ROOT/cmdline-tools/latest
    mv cmdline-tools-temp/cmdline/* $ANDROID_SDK_ROOT/cmdline-tools/latest/
    yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --licenses
    $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager "platform-tools" "platforms;android-33" "build-tools;33.0.2"
  env:
    JAVA_HOME: /opt/hostedtoolcache/Java_Temurin-Hotspot_jdk/11.0.29-7/x64
    PATH: $HOME/Android/Sdk/platform-tools:$HOME/Android/Sdk/cmdline-tools/latest/bin:$PATH

- name: Grant execute permission for gradlew
  run: chmod +x gradlew

- name: Build with Gradle (show stacktrace)
  run: ./gradlew build --stacktrace --info --no-daemon
  env:
    ANDROID_SDK_ROOT: ${{ runner.home }}/Android/Sdk
    ANDROID_HOME: ${{ runner.home }}/Android/Sdk
