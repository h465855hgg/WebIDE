<!--
  ~ WebIDE - A powerful IDE for Android web development.
  ~ Copyright (C) 2025  å¦‚æ—¥ä¸­å¤©  <3382198490@qq.com>
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebIDE æ¥å£åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 15px;
            padding-bottom: 250px; /* ä¸ºåº•éƒ¨æ—¥å¿—ç•™ç©ºé—´ */
        }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 8px; margin-top: 20px; }
        h4 { margin: 10px 0 5px 0; color: #555; }

        .card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 15px;
            margin-bottom: 15px;
        }

        /* æŒ‰é’®ç½‘æ ¼å¸ƒå±€ */
        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:active { background-color: #1f618d; transform: translateY(1px); }
        button.danger { background-color: #e74c3c; }
        button.success { background-color: #27ae60; }
        button.warning { background-color: #f39c12; }

        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 8px;
            font-family: monospace;
        }

        /* åº•éƒ¨æ—¥å¿—æ§åˆ¶å° */
        #console-log {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 200px;
            background: #222;
            color: #0f0;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            overflow-y: auto;
            padding: 10px;
            border-top: 3px solid #444;
            z-index: 999;
        }
        .log-item { border-bottom: 1px solid #333; padding: 2px 0; }
        .log-err { color: #ff5555; }
    </style>
</head>
<body>

<!-- é…ç½®åŒºåŸŸ -->
<div class="card">
    <h4>ğŸ”Œ æ¥å£é…ç½®</h4>
    <input type="text" id="bridgeName" value="websApp" placeholder="è¾“å…¥æ³¨å…¥å¯¹è±¡çš„åç§° (é»˜è®¤ websApp)">
    <div style="font-size: 12px; color: #666;">
        å½“å‰çŠ¶æ€: <span id="status">æ£€æµ‹ä¸­...</span>
    </div>
</div>

<!-- è„šæœ¬æ‰§è¡ŒåŒºåŸŸ (æ ¸å¿ƒåŠŸèƒ½) -->
<div class="card">
    <h2>ğŸš€ åŠ¨æ€è„šæœ¬ (Java/BeanShell)</h2>
    <p style="font-size:12px; color:#666;">å‰æï¼šApp éœ€é›†æˆ BeanShell æˆ– Groovy å¹¶åœ¨ evalJavaCode ä¸­å®ç°ã€‚</p>
    <textarea id="javaCode" rows="6" placeholder="åœ¨æ­¤è¾“å…¥ Java ä»£ç ...">import android.widget.Toast;
Toast.makeText(context, "Hello from BeanShell!", 1).show();
return "æ‰§è¡ŒæˆåŠŸ";</textarea>
    <div class="btn-group">
        <button class="success" onclick="runJava()">æ‰§è¡Œ Java ä»£ç </button>
        <button onclick="runJs()">æ‰§è¡Œ JS ä»£ç </button>
    </div>
</div>

<!-- ç³»ç»Ÿäº¤äº’ -->
<div class="card">
    <h2>ğŸ“± ç³»ç»Ÿä¸ UI</h2>
    <div class="btn-group">
        <button onclick="callApi('toast', 'è¿™æ˜¯ä¸€ä¸ª Toast')">Toast æç¤º</button>
        <button onclick="testNotification()">å‘é€é€šçŸ¥</button>
        <button onclick="callApi('openFlashLight')">æ‰“å¼€æ‰‹ç”µç­’</button>
        <button onclick="callApi('closeFlashLight')">å…³é—­æ‰‹ç”µç­’</button>
        <button onclick="callApi('shockDevice', 500)">éœ‡åŠ¨ 500ms</button>
        <button onclick="getClip()">è·å–å‰ªè´´æ¿</button>
        <button onclick="callApi('setClipContent', 'WebIDE å¤åˆ¶æµ‹è¯•')">å†™å…¥å‰ªè´´æ¿</button>
    </div>

    <h4>çŠ¶æ€æ /å¯¼èˆªæ é¢œè‰²</h4>
    <div class="btn-group">
        <button onclick="callApi('setStatuColor', '#FF0000')">çº¢çŠ¶æ€æ </button>
        <button onclick="callApi('setStatuColor', '#FFFFFF')">ç™½çŠ¶æ€æ </button>
        <button onclick="callApi('setNavColor', '#00FF00')">ç»¿å¯¼èˆªæ </button>
    </div>
</div>

<!-- ç¡¬ä»¶ä¿¡æ¯ -->
<div class="card">
    <h2>ğŸ”‹ ç¡¬ä»¶ä¸çŠ¶æ€</h2>
    <div class="btn-group">
        <button onclick="showRet('getBatteryTemperature')">ç”µæ± æ¸©åº¦</button>
        <button onclick="showRet('getMediaVolume')">åª’ä½“éŸ³é‡</button>
        <button onclick="showRet('getScreenBrightness')">å±å¹•äº®åº¦</button>
        <button onclick="showRet('getMemoryUsage')">å†…å­˜å ç”¨</button>
        <button onclick="showRet('getDeviceStatus')">è®¾å¤‡ä¿¡æ¯</button>
    </div>
</div>

<!-- æ–‡ä»¶æ“ä½œ -->
<div class="card">
    <h2>ğŸ“‚ æ–‡ä»¶ç³»ç»Ÿ</h2>
    <input type="text" id="filePath" value="/sdcard/webide_test.txt" placeholder="æ–‡ä»¶è·¯å¾„">
    <textarea id="fileContent" rows="3" placeholder="å†™å…¥å†…å®¹">Hello WebIDE File System</textarea>
    <div class="btn-group">
        <button onclick="doWriteFile()">å†™å…¥æ–‡ä»¶</button>
        <button onclick="doReadFile()">è¯»å–æ–‡ä»¶</button>
        <button onclick="doListFiles()">åˆ—å‡ºç›®å½•(sdcard)</button>
        <button class="danger" onclick="doDeleteFile()">åˆ é™¤æ–‡ä»¶</button>
    </div>
    <div class="btn-group" style="margin-top:10px;">
        <button onclick="callApi('openFile', getValue('filePath'))">è°ƒç”¨ç³»ç»Ÿæ‰“å¼€</button>
        <button onclick="callApi('installAPK', getValue('filePath'))">å®‰è£… APK</button>
    </div>
</div>

<!-- App æ“ä½œ -->
<div class="card">
    <h2>ğŸ›  App æ§åˆ¶</h2>
    <div class="btn-group">
        <button onclick="showRet('getAppName')">App åç§°</button>
        <button onclick="showRet('getAppVersion')">App ç‰ˆæœ¬</button>
        <button class="warning" onclick="callApi('restartApp')">é‡å¯ App</button>
        <button class="danger" onclick="callApi('exitApp')">é€€å‡º App</button>
    </div>
</div>

<!-- åº•éƒ¨æ—¥å¿— -->
<div id="console-log">
    <div class="log-item">Ready. Waiting for commands...</div>
</div>

<script>
    // è·å–æ³¨å…¥å¯¹è±¡å (é»˜è®¤ websAppï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯ Android)
    function getBridge() {
        var name = document.getElementById('bridgeName').value || 'websApp';
        return window[name];
    }

    function getValue(id) {
        return document.getElementById(id).value;
    }

    // åŸºç¡€æ—¥å¿—æ‰“å°
    function log(msg, isError) {
        var consoleDiv = document.getElementById('console-log');
        var div = document.createElement('div');
        div.className = 'log-item' + (isError ? ' log-err' : '');

        var time = new Date().toLocaleTimeString();
        div.innerText = "[" + time + "] " + msg;

        consoleDiv.appendChild(div);
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
        console.log(msg);
    }

    // æ£€æµ‹æ¥å£çŠ¶æ€
    setInterval(function() {
        var bridge = getBridge();
        var statusSpan = document.getElementById('status');
        if (bridge) {
            statusSpan.innerText = "âœ… å·²è¿æ¥ (" + document.getElementById('bridgeName').value + ")";
            statusSpan.style.color = "green";
        } else {
            statusSpan.innerText = "âŒ æœªæ‰¾åˆ°å¯¹è±¡";
            statusSpan.style.color = "red";
        }
    }, 1000);

    // é€šç”¨è°ƒç”¨æ–¹æ³•
    function callApi(methodName, ...args) {
        var bridge = getBridge();
        if (!bridge) {
            log("Error: æ¡¥æ¥å¯¹è±¡æœªæ‰¾åˆ°", true);
            return;
        }
        if (typeof bridge[methodName] === 'function') {
            try {
                log("è°ƒç”¨: " + methodName + "(" + args.join(", ") + ")");
                bridge[methodName](...args);
            } catch (e) {
                log("è°ƒç”¨å¼‚å¸¸: " + e.message, true);
            }
        } else {
            log("æ–¹æ³• " + methodName + " ä¸å­˜åœ¨", true);
        }
    }

    // è°ƒç”¨å¹¶æ˜¾ç¤ºè¿”å›å€¼
    function showRet(methodName, ...args) {
        var bridge = getBridge();
        if (!bridge) return log("Bridge not found", true);

        try {
            var ret = bridge[methodName](...args);
            log(methodName + " è¿”å›: " + ret);
            return ret;
        } catch (e) {
            log(methodName + " é”™è¯¯: " + e.message, true);
        }
    }

    // --- å…·ä½“åŠŸèƒ½å®ç° ---

    // 1. è¿è¡Œ Java ä»£ç  (BeanShell/Groovy)
    function runJava() {
        var code = document.getElementById('javaCode').value;
        callApi('evalJavaCode', code);
    }

    // 2. è¿è¡Œ JS ä»£ç  (evalJsCode)
    function runJs() {
        // æµ‹è¯•åå‘æ³¨å…¥
        callApi('evalJsCode', 'alert("è¿™æ˜¯ç”± Android è°ƒèµ·çš„ JS Alert");');
    }

    // 3. é€šçŸ¥æµ‹è¯•
    function testNotification() {
        // è°ƒç”¨ adapter.sendNotification(title, content)
        callApi('sendNotification', 'WebIDE é€šçŸ¥', 'è¿™æ˜¯ä¸€æ¡æ¥è‡ªç½‘é¡µçš„æ¶ˆæ¯');
    }

    // 4. è·å–å‰ªè´´æ¿
    function getClip() {
        var content = showRet('getClipContent');
        if(content) alert("å‰ªè´´æ¿å†…å®¹:\n" + content);
    }

    // 5. æ–‡ä»¶å†™å…¥
    function doWriteFile() {
        var path = getValue('filePath');
        var content = getValue('fileContent');
        callApi('writeFile', path, content);
        log("å†™å…¥æŒ‡ä»¤å·²å‘é€");
    }

    // 6. æ–‡ä»¶è¯»å–
    function doReadFile() {
        var path = getValue('filePath');
        var content = showRet('readFile', path);
        if (content) {
            document.getElementById('fileContent').value = content;
        }
    }

    // 7. åˆ—å‡ºæ–‡ä»¶
    function doListFiles() {
        var path = "/sdcard/";
        var result = showRet('listFiles', path);
        // Adapter ä¸­ç”¨ [FG] åˆ†å‰²
        if (result) {
            var files = result.split("[FG]");
            log("æ–‡ä»¶åˆ—è¡¨: " + files.join(", "));
            alert("SDå¡æ ¹ç›®å½•æ–‡ä»¶:\n" + files.slice(0, 10).join("\n") + "\n(ä»…æ˜¾ç¤ºå‰10ä¸ª)");
        }
    }

    // 8. åˆ é™¤æ–‡ä»¶
    function doDeleteFile() {
        var path = getValue('filePath');
        if(confirm("ç¡®å®šåˆ é™¤ " + path + " å—ï¼Ÿ")) {
            callApi('deletFiles', path); // æ³¨æ„ä½ çš„ Kotlin æ–¹æ³•åæ˜¯ deletFiles (æ‹¼å†™æ˜¯è¿™æ ·çš„)
            log("åˆ é™¤æŒ‡ä»¤å·²å‘é€");
        }
    }

</script>
</body>
</html>